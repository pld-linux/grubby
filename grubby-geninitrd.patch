--- mkinitrd-4.1.18/grubby/new-kernel-pkg	2005-01-05 23:14:45.000000000 +0200
+++ mkinitrd-4.1.18/grubby/new-kernel-pkg	2005-01-06 00:43:51.000000000 +0200
@@ -110,17 +110,10 @@
 	return
     fi
 
-    # get the root filesystem to use; if it's on a label make sure it's
-    # been configured. if not, get the root device from mount
-    rootdevice=$(awk '{ if ($1 !~ /^[ \t]*#/ && $2 == "/") { print $1; }}' /etc/fstab)
-    short=$(echo $rootdevice | cut -d= -f1)
-    if [ "$short" == "LABEL" ]; then
-	label=$(echo $rootdevice | cut -d= -f2 |head -n 1)
-	device=$(echo "showlabels" | /sbin/nash  --force --quiet | 
-			awk '$2 == "'$label'" {print $1}')
-	if [ -z "$device" ]; then
-	    rootdevice=$(mount | awk '$3 == "/" { print $1 }')
-	fi
+	find_root
+    rootdevice=$rootdev
+    if [ -z "$rootdevice" ]; then
+		rootdevice=$(mount | awk '$3 == "/" { print $1 }')
     fi
 
     if [ -n "$cfgGrub" ]; then
@@ -199,10 +192,10 @@
 
 mkinitrd() {
     [ -n "$verbose" ] && echo "creating initrd $initrdfile using $version"
-    /sbin/mkinitrd --allow-missing -f $initrdfile $version
+    /sbin/geninitrd -f --initrdfs=rom $initrdfile $version
     rc=$?
     if [ $rc != 0 ]; then
-	echo "mkinitrd failed" >&2
+	echo "geninitrd failed" >&2
 	exit 1
     fi
 }
